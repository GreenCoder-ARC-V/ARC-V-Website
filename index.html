<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ARC-V Control</title>
<style>
body {
    background:black;
    color:#00ffcc;
    font-family:monospace;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}
#container {
    text-align:center;
    width:600px;
}
button, input {
    background:black;
    color:#00ffcc;
    border:1px solid #00ffcc;
    padding:10px;
    margin:5px;
    font-family:monospace;
}
button:hover {
    background:#00ffcc;
    color:black;
    cursor:pointer;
}
pre {
    white-space:pre-wrap;
}
</style>
</head>

<body>
<div id="container">
    <h2>ARC-V ACCESS TERMINAL</h2>
    <div id="login">
        <input id="email" placeholder="Email"><br>
        <input id="password" type="password" placeholder="Password"><br>
        <button onclick="login()">ACCESS</button>
    </div>
    <pre id="screen"></pre>
    <div id="menu"></div>
</div>

<script type="module">
/* ================= FIREBASE ================= */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBVMI-1qNaTxw2T-TiPGVW6-FCTJyMCytg",
  authDomain: "arcvwebbackend.firebaseapp.com",
  projectId: "arcvwebbackend"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

/* ================= GLOBALS ================= */
const screen = document.getElementById("screen");
const menu = document.getElementById("menu");
let currentRank = "Guest";

const rankOrder = ["Guest","Member","VOIS","Admin"];

function hasAccess(userRank, requiredRank){
    return rankOrder.indexOf(userRank) >= rankOrder.indexOf(requiredRank);
}

/* ================= EFFECTS ================= */
function clearUI(){
    screen.textContent = "";
    menu.innerHTML = "";
}
async function type(text, speed=25){
    for(let c of text){
        screen.textContent += c;
        await new Promise(r=>setTimeout(r,speed));
    }
}

/* ================= LOGIN ================= */
window.login = async function(){
    clearUI();
    try{
        const user = await signInWithEmailAndPassword(
            auth,
            email.value,
            password.value
        );

        const snap = await getDoc(doc(db,"users",user.user.uid));
        currentRank = snap.exists() ? snap.data().rank : "Member";

        document.getElementById("login").style.display="none";
        await type("ACCESS GRANTED\n");
        await type("Rank: "+currentRank+"\n\n");
        mainMenu();
    }catch{
        await type("ACCESS DENIED");
    }
}

/* ================= MAIN MENU ================= */
window.mainMenu = function(){
    clearUI();
    type("MAIN CONTROL\n\n");
    menu.innerHTML = `
      <button onclick="loadSection('missions')">MISSIONS</button>
      <button onclick="loadSection('projects')">PROJECTS</button>
      <button onclick="loadSection('news')">NEWS</button>
    `;
}

/* ================= DYNAMIC LOADER ================= */
window.loadSection = async function(section){
    clearUI();
    await type(section.toUpperCase()+"\n\n");

    const snap = await getDocs(collection(db,section));
    snap.forEach(d=>{
        const data = d.data();
        const btn = document.createElement("button");
        btn.textContent = data.title;
        btn.onclick = async ()=>{
            clearUI();
            if(!hasAccess(currentRank,data.requiredRank)){
                await type("ACCESS DENIED\n");
                await type("Required Rank: "+data.requiredRank);
                menu.innerHTML=`<button onclick="loadSection('${section}')">RETURN</button>`;
                return;
            }
            await type(data.title+"\n\n");
            await type(data.description);
            menu.innerHTML=`<button onclick="loadSection('${section}')">RETURN</button>`;
        };
        menu.appendChild(btn);
    });

    menu.innerHTML += `<br><button onclick="mainMenu()">RETURN</button>`;
}
</script>
</body>
</html>


